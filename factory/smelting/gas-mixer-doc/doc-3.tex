% arara: lualatex: {shell: 1}
\documentclass{article}
\newif\ifprompts{}
\promptstrue{}
% \input{math-pre.tex}
\input{$HOME/Dropbox/Documents/TeX/math-pre.tex}
\setlist{
   itemsep=0em,
   %first={\setlength{\parskip}{1em}}
}
\setlength{\parindent}{0em}
\setlength{\parskip}{0.5em}
% \newenvironment{code}{\captionsetup{type=listing}}{}
% \newcommand{\colorA}{RoyalBlue}
% \newcommand{\colorB}{PineGreen}
% \newcommand{\colorC}{OrangeRed}
% \addbibresource{references.bib}

\DeclareMathOperator{\moles}{\mathrm{mol}}
\DeclareMathOperator{\Hyd}{\mathrm{H}_2}
\DeclareMathOperator{\Nit}{\mathrm{N}_2}
\DeclareMathOperator{\Ox}{\mathrm{O}_2}
\DeclareMathOperator{\Pol}{\mathrm{X}}
\DeclareMathOperator{\CDiox}{\mathrm{CO}_2}
\DeclareMathOperator{\Water}{\mathrm{H}_2\mathrm{O}}
\DeclareMathOperator{\NiOx}{\mathrm{N}_2\mathrm{O}}

\newcommand\pgfmathparseFPU[1]{
    \begingroup%
        \pgfkeys{/pgf/fpu,/pgf/fpu/output format=fixed}
        \pgfmathparse{#1}
        \pgfmathsmuggle\pgfmathresult
    \endgroup
}
% \def\GasConstant{8.314}
% \def\vF{1000}
% \def\tC{230}
% \def\tH{2300}
\newcommand{\setupparams}[6]{%
    \pgfmathsetmacro{\GasConstant}{8.314}
    \pgfmathsetmacro{\vF}{1000}
    \pgfmathsetmacro{\pF}{#1}
    \pgfmathsetmacro{\tF}{#2}
    \pgfmathparseFPU{\pF/\tF*\vF/\GasConstant)}\pgfmathsetmacro{\nF}{\pgfmathresult}
    \pgfmathsetmacro{\pT}{#3}
    \pgfmathsetmacro{\tT}{#4}
    \pgfmathparseFPU{\pT/\tT*\vF/\GasConstant)}\pgfmathsetmacro{\nT}{\pgfmathresult}
    \pgfmathsetmacro{\tC}{#5}
    \pgfmathsetmacro{\tH}{#6}
    \pgfmathsetmacro{\rG}{0}
    \pgfmathparseFPU{\nF-(\nT*(\tT-\tH))/(\tF-\tH)}\pgfmathsetmacro{\rR}{\pgfmathresult}
    \pgfmathparseFPU{\nF-(\nT*(\tT-\tC))/(\tF-\tC)}\pgfmathsetmacro{\rB}{\pgfmathresult}
}
\newcommand{\surf}{%
    \addplot3[%
        surf,
        samples=25,
        samples y=25,
        opacity=0.5,
        domain=0:\nF,
        domain y=\tC:\tH,
        variable=\nR,
    ]
    {(\tT*\nT-\tF*(\nF-\nR))/y};
}
\newcommand{\curve}{%
    \addplot3[%
        thick,
        color=red,
        samples=30,
        samples y=0,
        domain={max(\rG, max(\rR, \rB))}:\nF,
        domain y=\tC:\tH,
        variable=\nR,
    ]
    ({\nR},{(\tT*\nT-\tF*(\nF-\nR))/(\nT-\nF+\nR)},{\nT-\nF+\nR});
}
\newcommand{\Surf}[7][1.0]{%
    \setupparams{#2}{#3}{#4}{#5}{#6}{#7}
    \begin{tikzpicture}[scale=#1]
        \begin{axis}[
                title={$p_F=\pF$, $t_F=\tF$, $p_T=\pT$, $t_T=\tT$},
                xlabel=$n_R$, ylabel=$t_I$, zlabel=$n_I$,
                view={-135}{45},
                ymin=\tC, ymax=\tH,
                zmin=0,
            ]
            \surf%
        \end{axis}
    \end{tikzpicture}
}
\newcommand{\Curve}[7][1.0]{%
    \setupparams{#2}{#3}{#4}{#5}{#6}{#7}
    \begin{tikzpicture}[scale=#1]
        \begin{axis}[
                title={$p_F=\pF$, $t_F=\tF$, $p_T=\pT$, $t_T=\tT$},
                xlabel=$n_R$, ylabel=$t_I$, zlabel=$n_I$,
                view={-135}{45},
                ymin=\tC,ymax=\tH,
                zmin=0,
            ]
            \surf%
            \curve%
        \end{axis}
    \end{tikzpicture}
}
\newcommand{\Full}[7][1.0]{%
    \setupparams{#2}{#3}{#4}{#5}{#6}{#7}
    \begin{tikzpicture}[scale=#1]
        \begin{axis}[
                title={$p_F=\pF$, $t_F=\tF$, $p_T=\pT$, $t_T=\tT$},
                xlabel=$n_R$, ylabel=$t_I$, zlabel=$n_I$,
                view={-135}{45},
                ymin=\tC, ymax=\tH,
                zmin=0,
            ]
            \surf%
            \curve%
            \filldraw[green]
            (
                {\rG},
                {(\tT*\nT-\tF*\nF)/(\nT-\nF)},
                {\nT-\nF}
            ) circle (2pt) node {};
            \filldraw[red]
            (
                {\rR},
                {\tH},
                {\nT-(\nT*(\tT-\tH))/(\tF-\tH)}
            ) circle (2pt) node {};
            \filldraw[blue]
            (
                {\rB},
                {\tC},
                {\nT-(\nT*(\tT-\tC))/(\tF-\tC)}
            ) circle (2pt) node {};
        \end{axis}
    \end{tikzpicture}
}

\begin{document}

\section*{Todo}
\begin{itemize}
    \item Add motivations for calculation specif heat capacities and energies.
        That is, what do these quantities mean?
\end{itemize}

\section{Introduction and Summary}
In this section, I'll first attempt to introduce all relevant mathametical notation and gas laws,
then attempt summarize my solutions to the proposed problem:

\begin{quote}
    \begin{itshape}
        Given a furnace $F$ containing only $\CDiox$ at some arbitrary initial conditions, a source
        $H$ of relatively hot $\CDiox$ and a source $C$ of relatively cold $\CDiox$, is there not
        only some way of constructing a mixture of $H$ and $C$ such that inserting it into $F$
        (possibly after removing from initial gas from $F$) yields exactly some target temperature
        and pressure in $F$, but a way in which minimizes how much from $H$ and $C$ we need to add?
    \end{itshape}
\end{quote}

\subsection{Notation}

Firstly, I'll often write a closed mixture/volume of gasses as a single capital letter, like $F$ for
furnace, and where now $F$ symbolically refers to all the conditions of the furnace. Formally:
\begin{definition}[$M$ a gas mixture]
    Let $M$ be a ``mixture/volume'' of gasses; we write:
    \begin{itemize}
        \item $V_M$ for the total volume in liters of the system in which the mixture is contained,
        \item $n_M$ for the total number of moles in the mixture,
        \item $T_M$ for the temperature of the mixture,
        \item $P_M$ for the total pressure in kilopascals, and
        \item $C_M$ for the specific heat of the mixture.
    \end{itemize}
\end{definition}
Secondly, there are seven types of gasses in the game, each with a formula. I use the formulas as
\emph{indices} for the gasses. That is, if I say \emph{the gas $g$}, then what I mean is \emph{the
gas indexed by $g$, an element of the set of gas indices}.
\begin{definition}[$g$ a gas index]
    The set of gas indicies for Stationeers:
    \[
        \calG = \{\Hyd,\Nit,\Ox,\Pol,\CDiox,\Water,\NiOx\}.
    \]
    We assume that the order of these indices is always the same;
    that is, the first element of $\calG$ is always $\Hyd$, the second is always $\Nit$, and so on.

    Let $M$ be a mixture of the gasses indexed by the elements of $\calG$, and
    let $g\in\calG$ (read, $g$ is an element of $\calG\Leftrightarrow g=\Hyd$, or $\Nit$,\ \ldots, or $\NiOx$).
    Then we write:
    \begin{itemize}
        \item $n_M(g)$ for the moles of $g$ (the gas indexed by $g$) within mixture $M$,
        \item $P_M(g)$ for the partial pressure of $g$ within mixture $M$, and
        \item $C_g$ the \href{https://en.wikipedia.org/wiki/Specific_heat_capacity}{specific heat
            (capacity)} of a gas $g$.
    \end{itemize}
\end{definition}
(See see \autoref{fig:gas-table} for a table of the gasses in Stationeers, their $g$
formulas/indices, and their $C_g$ specific heats.)
\begin{figure}
    \begin{center}
        \begin{tabular}{*3l}
            \toprule
            Name & Formula ($g$) & Specific heat ($C_g$) \\
            \midrule
            Hydrogen & $\Hyd$ & 20.4 \\
            Nitrogen & $\Nit$ & 20.6 \\
            Oxygen & $\Ox$ & 21.1 \\
            Pollutant & $\Pol$ & 24.8 \\
            Carbon dioxide & $\CDiox$ & 28.2 \\
            Water & $\Water$ & 72 \\
            Nitrous oxide & $\NiOx$ & 23 \\
            \bottomrule
        \end{tabular}
    \end{center}
    \caption{Table of gasses in Stationeers}
    \label{fig:gas-table}
\end{figure}

All but the last of these conditions can be determined without much calculation; in particular $n_M$
the total moles, $T_M$ temperature and $P_M$ pressure can all be read directly from a furnace/pipe
analyzer/tank in game, and $n_M(g)$ moles of the particular gas $g$ can be calculated simply as the
ratio of the gas times the total moles:
\[
    n_M(g) = \text{(ratio of $g$ in $M$)}\cdot n_M,
    \text{ where } 0 \le \text{ratio of $g$ in $M$} \le 1.
\]
Note that if $M$ consists of only one kind of gas (which I index as $g^*$):
\[
    \text{if } 1 = \text{(ratio of $g^*$ in $M$)}
    \Rightarrow
    n_M(g^*) = 1\cdot n_M = n_M.
\]

\subsection{Gas laws}

Gasses in Stationeers obey some of the ideal gas laws from real life.
First, lets know how to calculate the specific heat of a mixture of gasses.
Recall that a gas, indexed by $g\in\calG$, has a specific heat $C_g$ (\autoref{fig:gas-table}).
\begin{definition}[Specific heat capacity of a gas mixture]
    Let $M$ be a mixture of the $\calG$ gasses. The specific heat of the mixture ($C_M$) is given by
    the sum of the products of the molar ratios of the gasses in the mixtures and their respective
    specific heats. We can notate this mathematically in a few ways:
    \[
        C_M
        = \frac{n_M(\Hyd)}{n_M}C_{\Hyd}
        + \frac{n_M(\Nit)}{n_M}C_{\Nit}
        + \cdots
        + = \frac{n_M(\NiOx)}{n_M}C_{\NiOx}
        = \sum_{g\in\calG} \frac{n_M(g)}{n_M}C_g
    \]
    Or as the dot-product $\cdot$ of vectors:
    \begin{equation}
        C_M = (\vec{n}_M \cdot \vec{C}_{\calG})\frac{1}{n_M}
    \end{equation}
    Where $\vec{n}_M$ is the vector of the moles per gas in $M$, and
    where $\vec{C}_{\calG}$ is the vector of the specific heats of each gas:
    \begin{align*}
        \vec{n}_M
        &= \angvec{n_M(\Hyd),n_M(\Nit),\ldots,n_M(\NiOx)}
        = \angvec{n_M(g):g\in\calG} \\
        \vec{C}_{\calG}
        &= \angvec{C_{\Hyd},C_{\Nit},\ldots,C_{\NiOx}}
        = \angvec{C_g:g\in\calG}.
    \end{align*}
\end{definition}
Note that if $M$ consists of only one kind of gas $g^*$, then the ratio of $g^*\in\calG$ is $M$ is one
(as noted before), and the ratio of $g\in\calG\setminus g^*$ in $M$ is zero.
(We read $g\in \calG\setminus g^*$ as: $g$ is an element of the set $\calG\setminus g^*$,
where $\calG\setminus g^*$ is the set $\calG$ but with the $g^*$ element removed.)
\begin{example}
    Suppose $F$ our furnace contains 10 moles of each kind of gas, of which there are seven.

    Then $n_F=70$, and:
    \begin{align*}
        C_F
        = \sum_{g\in\calG}\frac{n_F(g)}{n_F}C_g
        &= \frac{n_F(\Hyd)}{n_F}C_{\Hyd}+\frac{n_F(\Nit)}{n_F}C_{\Nit}+\cdots+\frac{n_F(\NiOx)}{n_F}C_{\NiOx} \\
        &= \frac{10}{70}\left(20.4 + 20.6 + 21.1 + 24.8 + 28.2 + 72 + 23\right)
        = 30.01
    \end{align*}
\end{example}
\begin{example}
    Suppose $F$ our furnace contains 70 moles of only $g^*=\CDiox$.

    Then $n_F=n_F(\CDiox)=70$, and:
    \begin{gather*}
        n_F(g) = \begin{cases}
            n_F(g) = n_F, & \text{if } g = \CDiox \\
            n_F(g) = 0, & \text{if } g \ne \CDiox \\
        \end{cases}, \\
        \begin{aligned}
            C_F
            &= \left(\vec{n}_F \cdot \vec{C}_{\calG}\right)\frac{1}{n_F} \\
            &=
            \left((0,0,0,0,70,0,0)
            \cdot
            (C_{\Hyd},C_{\Nit},C_{\Ox},C_{\Pol},C_{\CDiox},C_{\Water},C_{\NiOx})\right)
            \frac{1}{70}
            \\
            &= (70\cdot C_{\CDiox})\frac{1}{70} = C_{\CDiox}
        \end{aligned}
    \end{gather*}
\end{example}
This reduction of a volume's specific heat to a constant is one reason why I prefer a single gas
($\CDiox$) design; it reduces many of the later problems from problems of differential equations to
simple problems of algebra. The other reason is that $\CDiox$ is plentiful, both as at atmospheric
gas on planets like Mars and Venus and as a byproduct of combustion.

In terms of gas laws, the model in Stationeers obeys the following laws for a fixed volume of gas.

\begin{definition}[Gay-Lussac's law]
    \begin{equation}
        P_1 T_2=P_2 T_1
        \label{eq:gay-lussac}
    \end{equation}
    Change in pressure is directly proportional to change in temperature.
\end{definition}
\textbf{Note!} This law is only \emph{half}-obeyed! In game, changing the temperature in a
fixed volume expectedly affects the pressure proportionally, but not vice-versa. That is:
removing gas, i.e. ``lowering its pressure'', does \emph{not} change its temperature.

\begin{definition}[Ideal/combined gas law]
    \begin{equation}
        PV=nRT
        \label{eq:ideal}
    \end{equation}
    Where $R=8.314$ (joules per mole kelvin)
    is the \href{https://en.wikipedia.org/wiki/Gas_constant}{universal gas constant}.
\end{definition}

\begin{definition}[Dalton's law of partial pressures]
    \begin{equation}
        P
        = P(\Hyd)+P(\Nit)+P(\Ox)+P(\Pol)+P(\CDiox)+P(\Water)+P(\NiOx)
        = \sum_{g\in\calG}P(g)
        \label{eq:partial-p}
    \end{equation}
    The pressure in the volume is the sum of partial pressures of the constituent gasses.
\end{definition}

\begin{definition}[Energy of a volume gas]
    The energy of a volume of gas with temperature $T$, number of moles $n$, and
    (combined) specific heat $C$ is given by $TnC$.
\end{definition}

Furthermore, the game model satisfies these other equations.
Given volumes $A$ and $B$, and $C$ the result of combining $A$ and $B$:
\begin{flalign}
    &n_C = n_A + n_B &
    &\text{(moles are additive)} & \label{eq:n-combine} \\
    &C_C = \left((\vec{n}_A+\vec{n}_B)\cdot\vec{C}_{\calG}\right)\frac{1}{n_C} &
    &\text{(combined specific heat)} & \label{eq:C-combine} \\
    &T_C n_C C_C = T_A n_A C_A+T_B n_B C_B &
    &\text{(combined energies)} & \label{eq:energy-combine}
\end{flalign}
With all this notation and all these gas equations in mind,
we move onto solving the proposed problem.

\subsection{Summary}

Drafting up the scenario:

\emph{(Initial conditions)}
A furnace already contains some amount of ``hot'' $\CDiox$ as a starter. We add the reagents for
some alloy, releasing some other gasses into the furnace mix. We then filter out all gases except
for the $\CDiox$, returning the $\CDiox$ back into the furnace, leaving the furnace with only
$\CDiox$ gas but also the reagents for the alloy. For the alloy we require some specific
temperature, $T_T$ (target temperature), and pressure, $P_T$ (target pressure); we'll consider these
to be the minimum of whatever the alloy ranges are. Lastly, we have $H$ the ``hot'' source of
$\CDiox$ that has temperature $T_H$ of \emph{at least} $T_T$ kelvin, and have $C$ the ``cold''
source of $\CDiox$ that's \emph{at most} $T_T$ kelvin.

\emph{(The question now)}
How much of the furnace $\CDiox$ do we need to remove (if any) in order for
it to be possible to compose a \emph{minimal} combination $I$ of $\CDiox$ from the $H$ and $C$
sources, that when added to $F$ achieves $T_T$ and $P_T$ in the furnace.

\begin{figure}
    \begin{center}
        \begin{tabular}{cl}
            \toprule
            Volume & Description \\
            \midrule
            $F$   & The initial furnace volume \\
            $T$   & The target furnace volume \\
            $R$   & The volume removed from the initial \\
            $I$   & The input volume \\
            $H$   & The hot source \\
            $C$   & The cold source \\
            \bottomrule
        \end{tabular}
        \vspace{1em}

        \begin{tabular}{l*6c}
            \toprule
                           & Initial & Target & Removed & Input & Hot   & Cold  \\
            \midrule                                           
            Pressure       & $P_F$   & $P_T$  & ---     & ---   & ---   & ---   \\
            Temperature    & $T_F$   & $T_T$  & ---     & $T_I$ & $T_H$ & $T_C$ \\
            Moles $\CDiox$ & $n_F$   & $n_T$  & $n_R$   & $n_I$ & $n_H$ & $n_C$ \\
            \bottomrule
        \end{tabular}
    \end{center}
    \caption{Table of variables which we will encounter.}
    \label{fig:var-table}
\end{figure}

There will be many variables in the following work (see \autoref{fig:var-table} for descriptions for
all of the variables we will be encountering---note that I use \emph{volume}, \emph{mixture} and
\emph{composition} somewhat interchangeably when talking about some specific closed amount of gas,
and that volume here has nothing to do with the actual volume of the container in which the closed
amount of gas sits); we'll first lay out the relationships between
these different variables with respect to the laws and equations defined above. We will use these
relationships to establish a system of equations.

\subsubsection*{Calculating target moles}

Given that $P_T$ and $T_T$ are our fixed targets, we can use the ideal gas law (\autoref{eq:ideal})
to solve for $n_T$ the target moles we will need. From the game we know the volume of a furnace
$V_F$ to be 1,000 liters, and $R$ the universal gas constant is $8.314$ joules per mole kelvin (and
note that $1\ \text{kPa}=1\ \sfrac{\text{J}}{\text{m}^3}=1\ \sfrac{\text{J}}{\text{L}}$). Then:
\begin{align}
    P_T\ \sfrac{\text{J}}{\text{L}}\cdot V_F\ \text{L}
    &= n_T\ \text{mol}\cdot R\ \sfrac{\text{J}}{\text{mol}\ \text{K}}\cdot T_T\ \text{K} \notag \\
    \Rightarrow
    n_T\ \text{mol}
    &= \frac
        {P_T\ \sfrac{\text{J}}{\text{L}}\cdot V_F\ \text{L}}
        {R\ \sfrac{\text{J}}{\text{mol}\ \text{K}}\cdot T_T\ \text{K}}
    = \frac{P_T\cdot V_F}{R\cdot T_T}\text{mol}
\end{align}

\subsubsection*{Simplifying energy equations (\autoref{eq:C-combine} and \autoref{eq:energy-combine})}

Firstly, consider \autoref{eq:C-combine} for some volumes $A$, $B$ and $C$ of \emph{only} $\CDiox$,
and where $C$ is the combination of $A$ and $B$. Then:
\[
    C_C
    = \big((\vec{n}_A+\vec{n}_B)\cdot\vec{C}_{\calG}\big)\frac{1}{n_C}
    = (n_A(\CDiox)+n_B(\CDiox))C_{\CDiox}\frac{1}{n_C}
    = n_C C_{\CDiox}\frac{1}{n_C}
    = C_{\CDiox}.
\]
As well as $C_A=C_B=C_C=C_{\CDiox}$. Then \autoref{eq:energy-combine} can be simplified:
\begin{alignat}{4}
    &\phantom{\Rightarrow} &
    &\ T_C n_C C_C &
    \ = &\ T_A n_A C_A & &+\ T_B n_B C_B \notag \\
    &\Rightarrow &
    &\ T_C n_C C_{\CDiox} &
    \ = &\ T_A n_A C_{\CDiox} & &+\ T_B n_B C_{\CDiox} \notag \\
    &\Rightarrow &
    &\ T_C n_C &
    \ = &\ T_A n_A & &+\ T_B n_B.
    \label{eq:T-combine}
\end{alignat}
And this is all we need for a one-gas, $\CDiox$ system.

\subsubsection*{Bounds on moles}

Consider that an amount of moles cannot be negative, $0\le n_M$, and that we can only remove as many
moles as there are there initially, though we might remove none at all. This imposes a restriction
on $n_R$:
\[
    0 \le n_R \le n_F.
\]

\subsubsection*{Combinations of moles (applying \autoref{eq:n-combine})}

When we have theoretically reached our ideal target pressure and temperature, we will have removed
some amount of moles $n_R$ from the initial amount $n_F$ in the furnace $F$, and will have input
some amount of moles $n_I$ into the furnace. The number of moles $n_I$ of the input volume $I$ is a
function of $n_H$, some number of moles from the hot source, and $n_C$, some number of moles from
cold source, that must satisfy \autoref{eq:n-combine}:
\begin{equation}
    n_I = n_H + n_C.
    \label{eq:n-combine-model}
\end{equation}
The number of moles at the theoretical target must also satisfy this equation:
\begin{align*}
    n_T
    &= (n_F-n_R)+n_I \\
    \intertext{(Substituting \autoref{eq:n-combine-model})}
    &= (n_F-n_R)+(n_H + n_C).
\end{align*}

\subsubsection*{Combinations of energies (applying \autoref{eq:T-combine})}

The temperature and number of moles for the input volume is a function of the temperature and number
of moles from the hot and cold sources and must satisfy equation
\autoref{eq:T-combine}:
\begin{equation}
    T_I n_I = T_H n_H + T_C n_C.
    \label{eq:T-combine-model}
\end{equation}
Similarly, the temperature and number of moles for the target is a function of the initial
temperature in the furnace, the number of moles remaining in the furnace after having removed some
amount, and the temperature and number of moles of the input volume:
\begin{align}
    T_T n_T
    &= T_F(n_F-n_R)+T_I n_I \label{eq:T-combine-model-2} \\
    \intertext{(Substituting \autoref{eq:T-combine-model})}
    &= T_F(n_F-n_R)+(T_H n_H+T_C n_C). \label{eq:T-combine-model-3}
\end{align}
\emph{This is the equation we're most interested in, as combines all the parts of the problem
together and allows us to easily solve for either $T_I$ or $T_T$.}

\subsubsection*{Bounds on temperatures}

As setup in the paragraph of initial conditions, the hot source $H$ has temperature at least $T_T$
and the cold source $C$ has temperature at most $T_T$.
Thus we can always combine an amount from
$H$ and an amount from $C$ into a volume $I$ such that $T_I$ equals $T_T$.
So from this we get the bounds:
\[
    T_C\le T_T\le T_H,\text{ and }T_C\le T_I\le T_H.
\]
\begin{example}
    % (This will be more of an example of thinking about \emph{how} we can use these equations
    % to 
    Suppose we have initial conditions $T_F=500$, $P_F=1000$, $T_C=200$ and $T_H=2500$,
    but we don't have a particular target pressure $P_T$ or temperature $T_T$;
    we just want to see how things change as we remove some amount $n_R$ from $F$,
    add some amount $n_H$ from $H$ into $F$,
    and/or add some amount $n_C$ from $C$ into $F$.

    Lets call $T_E$, $P_E$ and $n_E$ our end results: the temperature, pressure and number
    of moles after having removed $n_R$ and having added $n_I$.
    Our procedure is this: pick values for $n_R$, $n_H$ and $n_C$,
    \begin{enumerate*}[label=(\alph*)]
        \item calculate $n_E=(n_F-n_R)+n_I$ where $n_I=n_H+n_C$,
        \item calculate $T_E$ by solving \autoref{eq:T-combine-model-3} for $T_E$, and then
        \item calculate $P_E$ by solving \autoref{eq:ideal} for $P_E$.
    \end{enumerate*}

    First we need to calculate $n_F$, the initial amount of moles in the furnace, using
    \autoref{eq:ideal} (recall that $V_F=1000$ and $R=8.314$):
    \[
        n_F
        = \frac{P_F\cdot V_F}{R\cdot T_F}
        = \frac{1000\cdot 1000}{8.314\cdot 500}
        \doteq 240.56 \text{ moles $\CDiox$}.
    \]
    (Alternatively, since this is Stationeers we're talking about, we would have been able to
    find this value just by reading the number of moles from the furnace:
    \mintinline{text}{l nF furnace TotalMoles}.)
    \begin{example}[$n_R=100$, $n_H=200$ and $n_C=0$]
        \phantom{ }
        \begin{enumerate}[label=(\alph*)]
            \item
                \begin{math}
                    n_E=(240.56-100)+(200+0)=340.56
                \end{math}
            \item
                \begin{math}
                    \begin{aligned}[t]
                        T_E
                        &= (T_F(n_F-n_R)+(T_H n_H+T_C n_C))/n_E \\
                        &= (500\cdot 140.56+(2500\cdot 200+200\cdot 0))/340.56
                        \doteq 1674.54\text{ K}.
                    \end{aligned}
                \end{math}
            \item
                \begin{math}
                    \begin{aligned}[t]
                        P_E
                        &= (n_E\cdot R\cdot T_E)/V_F \\
                        &= (340.56\cdot 8.314\cdot 1674.54)/1000
                        \doteq 4741.32\text{ kPa}.
                    \end{aligned}
                \end{math}
        \end{enumerate}
    \end{example}
    % \begin{example}[$n_R=0$, $n_N=0$, and $n_C=300$]
    %     \phantom{ }
    %     \begin{enumerate}[label=(\alph*)]
    %         \item
    %             \begin{math}
    %                 n_E=(240.56-0)+(0+300)=540.56
    %             \end{math}
    %         \item
    %             \begin{math}
    %                 T_E
    %                 % = (T_F(n_F-n_R)+(T_H n_H+T_C n_C))/n_E
    %                 = (500\cdot 240.56+(2500\cdot 0+200\cdot 300))/540.56
    %                 \doteq 1674.54\text{ K}.
    %             \end{math}
    %         \item
    %             \begin{math}
    %                 P_E
    %                 % = (n_E\cdot R\cdot T_E)/V_F
    %                 = (340.56\cdot 8.314\cdot 1674.54)/1000
    %                 \doteq 4741.32\text{ kPa}.
    %             \end{math}
    %     \end{enumerate}
    % \end{example}
\end{example}


\subsection{Calculating minimal amounts}

We have enough bounds here to establish a system of equations with which we can solve the problem;
that is to be able to solve for a minimal amounts $n_R$ to remove, $n_H$ of $H$ to add and $n_C$ of
$C$ to add. It will be a matter of solving these equations for particular variables, and applying
certain metrics to solve for these minimal values.

First, solve \autoref{eq:T-combine-model-2} for $n_I$. This yields $n_I$ as a function of $n_R$ and
$T_I$; the remaining variables ($T_T$, $n_T$, $T_F$ and $n_F$) are all fixed:
\begin{equation}
    f(n_R,T_I) = n_I = \frac{T_T n_T+T_F(n_F-n_R)}{T_I}.
    \label{eq:surf}
\end{equation}
We can plot this function $f$, being of two variables $n_R$ and $T_I$, in three dimensions using the
bounds on $T_I$ and $n_R$: that $T_C\le T_I\le T_H$ and $0\le n_R\le n_F$. \autoref{fig:surfaces}
visualizes this bounded surface for a few different initial conditions (in all cases I chose
$T_C=200$ and $T_H=2500$). What this shows us is that any point $\big(n_R,T_I,f\big)$ (where $f$ is
shorthand for $f(n_R,T_I)$) on the surface satisfies \autoref{eq:surf}.
\begin{figure}
    \begin{center}
        \begin{subfigure}{0.32\textwidth}
            \Surf[.5]{4000}{500}{9000}{700}{200}{2500}
        \end{subfigure}
        \begin{subfigure}{0.32\textwidth}
            \Surf[.5]{6000}{600}{5000}{800}{200}{2500} % red example
        \end{subfigure}
        \begin{subfigure}{0.32\textwidth}
            \Surf[.5]{15000}{900}{6000}{600}{200}{2500} % blue example
        \end{subfigure}
        \caption{The surface defined by $(n_R,T_I,f)$ for various initial conditions.}
        \label{fig:surfaces}
    \end{center}
    % \caption[]{%
    %     The $(n_R,t_I,f)$ solution surface
    %     and $(n_R,h,g)$ embedded curve.
    % }
    % \caption{Surface defined by $f:
    % \label{fig:plot-1}
\end{figure}

% \autoref{eq:C-combine}
% \autoref{eq:T-combine}

% Our goal: 
\end{document}
